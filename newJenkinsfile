def remote = [:]
properties([parameters([string(description: 'Select the server OS', name: 'OS')])])

node {
     

      stage('execute') {
                      if ("${params.OS}" == 'Ubuntu') 
                        {
                        stage('script') {
                        withCredentials([sshUserPrivateKey(credentialsId: 'new-ubuntu_pem_file', keyFileVariable: 'identity', passphraseVariable: 'pass', usernameVariable: 'ubuntu')])
         {      
         remote.user = ubuntu
         remote.identityFile = identity
         remote.name = "ubuntu"
         remote.host = "13.235.245.51"
         remote.allowAnyHosts = true
        sshCommand remote: remote, command: 'ls'
                sshCommand remote: remote, command: 'sudo pwd'    
        }}
        }
        else {
            sh "echo 'Hello from "${params.OS}" branch!'"
        }
      }
    }

