def remote = [:]

node {
     parameters {
     string description: 'Select the server OS', name: 'OS'
    }

      stage('execute') {
                     withCredentials([sshUserPrivateKey(credentialsId: 'new-ubuntu_pem_file', keyFileVariable: 'identity', passphraseVariable: 'pass', usernameVariable: 'ubuntu')])
               
         remote.user = ubuntu
         remote.identityFile = identity
         remote.name = "ubuntu"
         remote.host = "13.235.245.51"
         remote.allowAnyHosts = true
        {
         if ($OS == 'Ubuntu') {
                sshCommand remote: remote, command: 'ls'
                sshCommand remote: remote, command: 'sudo pwd'    
        } else {
            sh "echo 'Hello from ${env.BRANCH_NAME} branch!'"
        }
      }
    }
}
